---
title: ğŸ¦€ Rust çš„åŠ¨æ€å‚æ•°ï¼šä»å®å¯æ¢¦çœ‹ä¼ é€’åŠ¨æ€å‚æ•°çš„ä¸‰ç§æ–¹æ³•
date: 2023-12-11 14:25:09
tags: 
- Rust
- ç¼–ç¨‹è¯­è¨€
summary: Rust ä¸­çš„åŠ¨æ€å‚æ•°ä¼ é€’æ³•åˆ™æœ‰ä¸€äº›å¤æ‚ï¼Œä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œæ‰€ä»¥ä¼šæ˜¾å¾—å¼‚å¸¸â€œä¸¥è°¨â€ã€‚è¿™ç¯‡æ–‡ç« å°±è¯•å›¾æ€»ç»“è¿™äº›æ–¹æ³•ã€‚
draft: false
---

åœ¨é˜…è¯»æ–‡ç« å‰ï¼Œç¡®ä¿ä½ å·²ç»äº†è§£ä»¥ä¸‹çš„åŸºæœ¬çŸ¥è¯†ï¼š

- åŸºæœ¬ rust è¯­æ³•ï¼šå‡½æ•°å®šä¹‰ï¼Œå£°æ˜å’Œè°ƒç”¨
- rust çš„ç‰¹å¾å’Œç‰¹å¾å¯¹è±¡
- rust ä¸­æ³›å‹çš„ä½¿ç”¨å’ŒåŸºæœ¬è¯­æ³•
- rust ä¸­æšä¸¾ enum çš„ä½¿ç”¨

# 0 è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨åšé¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°åœ¨å®šä¹‰å‡½æ•°æ—¶è¦åŠ¨æ€ä¼ é€’å‚æ•°ç±»å‹ã€‚

è€ƒè™‘ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```rust
struct PlainMessage {
  pub title: String,
  pub content: String
};
```

```rust
fn print_message(foo: PlainMessage) {
  /// ... æ‰“å°è¿™ä¸ª message
}
```

ä»¥ä¸Šä»£ç ä¸­ï¼Œ print_message å‡½æ•°åªèƒ½å¤„ç† PlainMessage ç±»å‹çš„æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦å¤„ç†æ›´å¤šç±»å‹çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªæ–°çš„æ¶ˆæ¯ç»“æ„ï¼š

```rust
// å®šä¹‰ä¸€ä¸ªæ–°ç±»å‹çš„ Messageï¼Œå¸¦æœ‰ä¸€ä¸ªæ ‡ç­¾ Tag
struct TaggedMessage {
  pub tag: String,
  pub title: String,
  pub content: String
}
```

åœ¨è§£å†³é—®é¢˜ä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹ rust çš„ â€œç‰¹å¾â€

## 0.1 ç®€ä»‹ï¼šrust ä¸­çš„ç‰¹å¾

Rust ä¸æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå®ƒç”¨â€œç‰¹å¾â€æ¥è¾¾æˆç±»ä¼¼çš„é¢å‘å¯¹è±¡çš„ç‰¹æ€§ã€‚

å¦‚æœç”¨å®å¯æ¢¦çš„èº«ä½“å½¢çŠ¶ç‰¹å¾ç±»æ¯”ï¼š

- å°ç«é¾™å’Œæ°å°¼é¾Ÿå±äºâ€œåŒè¶³å…½å½¢â€å®å¯æ¢¦
- èƒ–ä¸å’Œè‡­è‡­èŠ±åˆ™æ˜¯â€œäººå½¢â€å®å¯æ¢¦
- æ¯”æ¯”é¸Ÿå’Œè¶…éŸ³è éƒ½å½’äºâ€œåŒç¿…å‹â€å®å¯æ¢¦

![ä¸åŒå®å¯æ¢¦çš„ä½“å‹å’Œå®ƒä»¬çš„ä½“å‹ç‰¹å¾](2023-12-11-rust-dynamic-parameters\image.png)

å›åˆ°æ¶ˆæ¯çš„ä¾‹å­ï¼Œå‡è®¾ç›®å‰æœ‰ä¸¤ç§ä¸åŒçš„æ¶ˆæ¯ï¼Œç»“æ„ä½“ä¸­å­—æ®µæ•°é‡ä¸åŒï¼Œä½†æ˜¯ä»–ä»¬éƒ½å¯ä»¥è¢«æ‰“å°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œâ€œå¯æ‰“å°â€å°±æ˜¯ä¸€ä¸ªç‰¹å¾ã€‚

```rust
// å®šä¹‰ä¸€ä¸ªâ€œå¯æ‰“å°â€çš„ç‰¹å¾
trait Printable {
  fn print_message(&self);
}

// ä¸º PlainMessage å®ç°å¯æ‰“å°ç‰¹å¾
impl Printable for PlainMessage {
  fn print_message(&self) {
    println!("{} {}", &self.title, &self.content)
  }
}

// ä¸º TaggedMessage å®ç°å¯æ‰“å°ç‰¹å¾
impl Printable for TaggedMessage {
  fn print_message(&self) {
    println!("{} {} {}", &self.tag, &self.title, &self.content)
  }
}
```

å…³äºç‰¹å¾æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œå¯çœ‹å‚è€ƒæ–‡çŒ®

# 1 æ¨èï¼šä½¿ç”¨ç‰¹å¾å¯¹è±¡ï¼ˆåŠ¨æ€çš„æ–¹æ³•ï¼‰

å¦‚æœæŠŠå®å¯æ¢¦çš„èº«ä½“å½¢çŠ¶è§†ä¸ºâ€œç‰¹å¾â€ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œåŒç¿…å‹â€å®å¯æ¢¦ä½œä¸ºå‚æ•°çš„æ—¶å€™ï¼Œåˆ™æ¯”æ¯”é¸Ÿå’Œè¶…éŸ³è éƒ½ç¬¦åˆæ¡ä»¶ã€‚æ‰€ä»¥ï¼Œâ€œåŒç¿…å‹â€å°±æ˜¯æˆ‘ä»¬è¦çš„ç‰¹å¾ï¼Œå®ƒå¯ä»¥ä½œä¸ºç‰¹å¾å¯¹è±¡æ¥æŒ‡å®šå‚æ•°ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠâ€œå¯æ‰“å°â€ä½œä¸ºç‰¹å¾å¯¹è±¡çš„ç‰¹å¾æ¥æŒ‡å®šå‚æ•°ï¼š

```rust
// å°†ç‰¹å¾æŒ‡å®šä¸ºç‰¹å¾å¯¹è±¡ä½œä¸ºå‡½æ•°å‚æ•°
// æ³¨æ„ï¼šç‰¹å¾å¯¹è±¡å¿…é¡»ä½¿ç”¨ Box æ™ºèƒ½æŒ‡é’ˆåŒ…è£¹åæ‰èƒ½ä½œä¸ºå‚æ•°
// ä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ
// å› ä¸ºæ™ºèƒ½æŒ‡é’ˆåœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå†…å­˜é•¿åº¦ï¼Œä½¿ç”¨ Box åŒ…è£¹åçš„æ™ºèƒ½æŒ‡é’ˆå¯ä»¥ç¡®å®šã€‚è€Œ rust æ— æ³•æ¥å—å†…å­˜é•¿åº¦ä¸å›ºå®šçš„å‡½æ•°å£°æ˜
fn print_dyn(foo: Box<dyn Printable>) {
  foo.print_message()
}

fn main() {
  let msg = PlainMessage {
    title: "test_title".to_string(),
    content: "test_content".to_string()
  };
  // ç”¨ Box åŒ…è£¹ msg å¯¹è±¡åæ‰èƒ½ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚
  print_dyn(Box::new(msg));
}
```

è¿™ç§æ–¹æ³•çµæ´»ä½†æ˜¯æœ‰æ€§èƒ½æŸå¤±ï¼Œç‰¹å¾å¯¹è±¡ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†æ€§èƒ½çš„è´Ÿé¢å½±å“ï¼Œå› ä¸ºç¼–è¯‘å™¨æ— æ³•åœ¨ç¼–è¯‘æ—¶å¯¹ç‰¹å¾å¯¹è±¡å‚æ•°åšä¼˜åŒ–ã€‚

# 2 æ¨èï¼šä½¿ç”¨æ³›å‹ï¼ˆé™æ€çš„æ–¹æ³•ï¼‰

æ³›å‹å¯ä»¥ç†è§£æˆä¸€ç§ä»£ç çš„â€œæ¨¡æ¿â€ã€‚æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶å¯ä»¥ä¸å°†ç±»å‹å†™æ­»ã€‚ç¼–è¯‘æ—¶æ ¹æ®è°ƒç”¨å‡½æ•°çš„æƒ…å†µï¼Œå†æŒ‡å®šå‚æ•°ç±»å‹ã€‚

```rust
// å®šä¹‰ä¸€ä¸ªæ³›å‹çš„æ–¹æ³•ï¼ŒæŒ‡å®š T ä¸ºæ³›å‹ï¼Œè¯¥æ³›å‹éœ€è¦å®ç° Printable ç‰¹å¾
fn print_generic<T: Printable>(foo: T) {
  foo.print_message()
}

fn main() {
  let msg = PlainMessage {
    title: "test_title".to_string(),
    content: "test_content".to_string()
  };
  // ç›´æ¥æŠŠ msg å‚æ•°ä¼ å…¥å‡½æ•°å³å¯
  print_generic(msg);
}
```

æ³›å‹å’Œç‰¹å¾å¯¹è±¡çš„ä¸åŒï¼šç¼–è¯‘å™¨ç¡®å®šæ³›å‹ç±»å‹æ—¶ï¼Œæ˜¯â€œé™æ€çš„â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¼–è¯‘å™¨å°†æºä»£ç ç¼–è¯‘åˆ°å¯æ‰§è¡Œä»£ç æ—¶ï¼Œä¼šç¡®å®šçœŸæ­£çš„å‚æ•°ç±»å‹ï¼Œä¹Ÿå«â€œå•æ€åŒ–â€ã€‚è€Œç‰¹å¾å¯¹è±¡åœ¨ç¼–è¯‘æ—¶ä¸ä¼šç¡®å®šæ–¹æ³•å‚æ•°çš„çœŸæ­£ç±»å‹ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬ä¼ å…¥çš„æ˜¯ PlainMessage ç±»å‹ï¼Œç¼–è¯‘å™¨å°±ä¼šç”Ÿæˆ `fn print_generic(foo: PlainMessage)`å‡½æ•°ã€‚åŒç†ï¼Œå¦‚æœä¼ å…¥`TaggedMessage` ç¼–è¯‘å™¨å°±ä¼šç”Ÿæˆ fn `print_generic(foo: TaggedMessage)`å‡½æ•°ã€‚

è¿™ç§æ–¹æ³•é«˜æ•ˆä½†æ˜¯ç¼ºä¹çµæ´»æ€§ï¼Œç¼–è¯‘å™¨å¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šå‚æ•°ç±»å‹ï¼Œè¿è¡Œæ—¶æ€§èƒ½å¥½ã€‚ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»ã€‚

ä¸å¤Ÿçµæ´»ä½“ç°åœ¨å“ªé‡Œï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœå‡½æ•°å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå¹¶ç”¨æ³›å‹æè¿°å‚æ•°ï¼š

```rust
// ä»¥ä¸‹å‡½æ•°å°† left å’Œ right ç›¸åŠ ï¼Œå¹¶è¿”å›ç›¸åŒçš„æ•°æ®ç±»å‹
fn add<T: std::ops::Add<Output = T>>(left: T, right: T) -> T{
  return left+right
}
```

è¿™ä¸ªå‡½æ•°ä¸­ï¼Œleft å’Œ right åªèƒ½æ˜¯åŒä¸€ç±»å‹ï¼ˆi32 æˆ–è€… f32ï¼‰ï¼Œå¦‚æœ left å’Œ right æ˜¯ä¸åŒç±»å‹ï¼Œè¿™æ ·çš„å†™æ³•æ˜¯é€šä¸è¿‡ç¼–è¯‘çš„ã€‚

# 3 æšä¸¾çš„åŒä¸€åŒ–å¤„ç†ï¼ˆé™æ€çš„æ–¹æ³•ï¼‰

å¦ä¸€ç§æ–¹æ³•æ˜¯å°†ä¸¤ç§ä¸åŒçš„ç±»å‹ç”¨ enum åšåŒä¸€åŒ–å¤„ç†ï¼Œç„¶åå†ä½œä¸ºå‚æ•°ä¼ å…¥

```rust
// ç”¨æšä¸¾åŒä¸€åŒ–ä¸¤ç§ä¸åŒçš„å‚æ•°
enum Message {
  plain(PlainMessage),
  tagged(TaggedMessage)
}

fn print_enum(foo: Message) {
  // ä½¿ç”¨ match è¡¨è¾¾å¼æ¥åˆ†åˆ«å¤„ç†ä¸¤ç§ä¸åŒçš„ç±»å‹
  match foo {
    Message::plain(msg) => {
      msg.print_message()
    },
    Message::tagged(msg) => {
      msg.print_message()
    }
  }
}

fn main() {
  let msg = PlainMessage {
    title: "test_title".to_string(),
    content: "test_content".to_string()
  };
  // åœ¨å°† msg ä½œä¸ºå‚æ•°ä¼ å…¥å‰éœ€è¦ç”¨ Message æšä¸¾åŒ…è£¹å¥½ä»¥åï¼Œæ‰èƒ½ä½œä¸ºå‚æ•°ä¼ å…¥
  print_enum(Message::plain(msg));
}
```

è¯¥æ–¹æ³•è¦æ ¹æ®ä¸åŒç±»å‹åˆ†å¼€å†™é€»è¾‘ï¼Œç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå•°å—¦ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯**å¯å°†å®Œå…¨ä¸åŒçš„ç±»å‹ç»Ÿä¸€åˆ°ä¸€èµ·**ã€‚

åœ¨å®å¯æ¢¦çš„ä¾‹å­é‡Œé¢ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠå°ç«é¾™å’Œæ¯”æ¯”é¸Ÿæ”¾åœ¨ä¸€èµ·ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå°½ç®¡ä»–ä»¬ä¹‹é—´æ²¡æœ‰å…±åŒçš„ç‰¹å¾ã€‚

# å‚è€ƒ

[å®å¯æ¢¦åˆ—è¡¨ï¼ˆæŒ‰ä½“å½¢åˆ†ç±»ï¼‰ - ç¥å¥‡å®è´ç™¾ç§‘ï¼Œå…³äºå®å¯æ¢¦çš„ç™¾ç§‘å…¨ä¹¦](https://wiki.52poke.com/wiki/%E5%AE%9D%E5%8F%AF%E6%A2%A6%E5%88%97%E8%A1%A8%EF%BC%88%E6%8C%89%E4%BD%93%E5%BD%A2%E5%88%86%E7%B1%BB%EF%BC%89)

[ç‰¹å¾ Trait - Rustè¯­è¨€åœ£ç»(Rust Course)](https://course.rs/basic/trait/trait.html)

[ç‰¹å¾å¯¹è±¡ - Rustè¯­è¨€åœ£ç»(Rust Course)](https://course.rs/basic/trait/trait-object.html)

[æ³›å‹ Generics - Rustè¯­è¨€åœ£ç»(Rust Course)](https://course.rs/basic/trait/generic.html)

[æšä¸¾ - Rustè¯­è¨€åœ£ç»(Rust Course)](https://course.rs/basic/compound-type/enum.html)
