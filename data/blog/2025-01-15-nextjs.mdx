---
title: 选用 NextJS 之前要注意什么？做了三个项目之后，谈谈我的想法
date: 2025-01-15
tags:
- 前端
summary: Next 作为一个全家桶预言，包含了前端和后端的所有功能。不仅方便了开发，也展现了 JS 的强大万能实力。
draft: false
---

最近好奇使用了一下 NextJS 做了一个后台页面。用了一段时候发现，这个框架极有意思。

当前的主流框架，一般都采用前后端分离的单页面应用模式（SPA）。浏览器就相当于一个应用程序，只不过这个应用程序由浏览器在访问网站时加载，而不需要在本地利用安装程序先安装。

然而 NextJS 却创新地，将现代前端开发技术和传统的服务器渲染技术（SSR）结合，做成了一个开箱即用的，既包含了前端功能，也包含了后端功能的“大而全”的框架。

## 服务端渲染（SSR）的背景

其实最早的 Web 端应用就是服务端渲染。例如在我们大学里学的 JSP、ASP 等框架，网页的加工处理由服务器完成，然后发送给浏览器渲染。可以说浏览器只是一个“显示器”，只是渲染网页就可以了。

而后，HTML + CSS + JS 技术栈称为主流，Node 兴起，程序员们发现 JS 可以有很强的处理能力，于是出现了前后端分离的架构。服务器只要处理好数据发送给浏览器，浏览器可以对数据做更多的加工、处理、渲染，最终展示给用户。

前后端分离将网页模版的渲染过程放在了浏览器，简化了服务器的逻辑，同时也减轻了服务器的计算压力。

随着云计算和移动互联网的发展，前端的开发方式出现了回潮。云服务使得计算能力随处可得，5G 也让通信流量成本大幅降低。边缘计算，ServerLess 甚至在部分平台可以免费使用。

在这样的背景下，服务端渲染重获生机，NextJS 和 NuxtJS 这样的一体化框架开始出现。

## 我的感受：全而美

语法和框架细节不是本文要讨论的主题，请自行搜索 NextJS 的教程。例如官方的：[Learn Next.js | Next.js by Vercel - The React Framework](https://nextjs.org/learn)

我把 NextJS 的优点总结为以下几点：
- **一体化和干净**：NextJS 有点类似于 SpringBoot 这样的 Web 全家桶，它自带了一套服务器和模版渲染引擎。直接创建一个项目，TS/JS 就可以完成服务端操作和客户端页面渲染，项目既干净又美丽。而无需学习其他语言，在一个项目里混杂各种不同语言的语法。
- **SEO**：因为服务端渲染，搜索引擎的爬虫无需执行页面上的 JS 就能获得全部的页面信息，使得搜索引擎能够更好地收入网页
- **性能**：得益于一体化，NextJS 在其内部对函数计算和缓存做了更多优化。而懒加载，服务端发送到客户端数据的缓存，都能很方便地处理。
- **部署**：部署极为方便，直接 `npm run build` 就可以得到 Web 应用，开发调试也做了很多优化。如果利用 vercel 技术栈，那是更加方便了。

## 一些注意事项

对于对前端熟练的开发者来说，也许这里有最关键的一点是你要注意的：

注意**运行边界**，就是**一定要搞清楚你正在写的代码，到底运行在服务器还是浏览器**。

这里有很多奥妙，而也是我认为 NextJS 最大的一个坑。这一切的根源就是在于 NextJS 会自动拆分代码，一部分运行在服务器，另一部分运行在客户端。

所以，在落笔代码之前，一定要对你的项目有个大体的构架。哪些功能用 Server 组件，哪些用客户端渲染的 Client 组件，哪些地方用 ServerAction，哪些地方声明 API Routes。

否则，你的项目在运行时会遇到大量错误，其中很多需要重构才能解决。

对于这个问题，我有以下四点总结：

- 优先使用服务端渲染的 Server 组件（`'use server'`）：因为会最大化 NextJS 的优势，也可以获得更好的性能。一般来说，数据展示、单项的表单提交这样的功能都适合用服务端渲染。当然 NextJS 默认也是服务端渲染。
- 复杂交互使用客户端渲染的 Client 组件（`'use client'`）：当服务端渲染无法胜任的时候，考虑客户端渲染。一般需要客户端处理的情况：复杂的表单交互，绘图，动画，复杂的响应。对于复杂的页面，做好 Server 和 Client 组件的相互嵌套，达到最好的懒加载效果。
- ServerAction：绝大部分在服务端执行的操作都可以用 ServerAction 来做，例如发起 http request，操作数据库等。NextJS 会为你自动做好代码拆分，保证缓存的有效和代码的安全性。
- API Routes：我个人认为，API Router 的存在是为了保证最大的兼容性，所以最好只有在外部系统要访问当前项目的时候再考虑利用 API Router 来开发。否则尽量使用 ServerAction 以获得更好的性能。

你可以参考：
- 关于挑选客户端和服务端组件：[Rendering: Composition Patterns | Next.js](https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns)
- 关于 ServerAction：[Data Fetching: Server Actions and Mutations | Next.js](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations)
- 关于 API Routes：[Routing: Route Handlers | Next.js](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)
- 关于挑选 ServerAction 还是 API Routes：[reactjs - Nextjs 14: Server actions vs Route handlers - Stack Overflow](https://stackoverflow.com/questions/77748391/nextjs-14-server-actions-vs-route-handlers)

## 关于编程框架的反思

越大而全的框架限制越多，学习、适应的成本也就越高。并且全面的框架在使用方便的同时，定制起来就会限制更多，如果要改一些预设好的功能，有时也许需要 Hacking。

框架的定制，会有种“戴着镣铐跳舞”的感觉。

总之，计算机技术“没有银弹”。每个框架都有优缺点，都有其适用范围，而我对此的建议是，**在什么场景下就使用什么样的技术**，别硬来，别纠结。
